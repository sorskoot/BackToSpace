(()=>{var e={898:function(e,t){var n;n=function(e){"use strict";function t(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function r(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}function i(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function s(e,t){t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.body}function a(e,t,n){var o,r,i=(n=n||{}).body;return n.method=e,n.headers=n.headers||{},i instanceof FormData||i&&"object"==typeof i&&(n.headers["content-type"]="application/json",n.body=JSON.stringify(i)),n.withCredentials&&(n.credentials="include"),n.timeout&&(r=new AbortController,n.signal=r.signal,o=setTimeout(r.abort,n.timeout)),new Promise(((e,a)=>{fetch(t,n).then(((t,r)=>{clearTimeout(o),s(t,t),r=t.status>=400?a:e,(i=t.headers.get("content-type"))&&~i.indexOf("application/json")?t.text().then((e=>{try{t.data=JSON.parse(e,n.reviver),r(t)}catch(e){e.headers=t.headers,s(t,e),a(e)}})):r(t)})).catch((e=>{e.timeout=r&&r.signal.aborted,a(e)}))}))}var c,u=a.bind(a,"GET"),h=a.bind(a,"POST"),f=a.bind(a,"PATCH"),d=a.bind(a,"DELETE"),l=a.bind(a,"PUT"),p=u,y=h,g={del:d,get:p,patch:f,post:y,put:l,send:a},v=t({__proto__:null,default:g,del:d,get:p,patch:f,post:y,put:l,send:a},[g]);!function(e){e[e.CONSENTED=4e3]="CONSENTED",e[e.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c||(c={}));var m=function(e){function t(t,n){var o=e.call(this,n)||this;return o.name="ServerError",o.code=t,o}return o(t,e),t}(Error);function b(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}b.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},b.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},b.prototype._str=function(e){var t=function(e,t,n){for(var o="",r=0,i=t,s=t+n;i<s;i++){var a=e.getUint8(i);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(r=(7&a)<<18|(63&e.getUint8(++i))<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0)>=65536?(r-=65536,o+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):o+=String.fromCharCode(r)}else o+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0);else o+=String.fromCharCode((31&a)<<6|63&e.getUint8(++i));else o+=String.fromCharCode(a)}return o}(this._view,this._offset,e);return this._offset+=e,t},b.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},b.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,o=0,r=0,i=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),o=this._view.getInt8(this._offset+1),this._offset+=2,-1===o){var s=this._view.getUint32(this._offset);return r=this._view.getInt32(this._offset+4),i=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*r+i)+s/1e6)}return[o,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),o=this._view.getInt8(this._offset+2),this._offset+=3,[o,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),o=this._view.getInt8(this._offset+4),this._offset+=5,[o,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return r=this._view.getUint32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,r+i;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return r=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,r+i;case 212:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?void(this._offset+=1):[o,this._bin(1)];case 213:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(2)];case 214:return o=this._view.getInt8(this._offset),this._offset+=1,-1===o?(e=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*e)):[o,this._bin(4)];case 215:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?(r=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+i)):-1===o?(r=this._view.getUint32(this._offset),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&r)+i)+(r>>>2)/1e6)):[o,this._bin(8)];case 216:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")};var _=4294967295,w=17179869183;function E(e,t,n){for(var o=0,r=0,i=n.length;r<i;r++)(o=n.charCodeAt(r))<128?e.setUint8(t++,o):o<2048?(e.setUint8(t++,192|o>>6),e.setUint8(t++,128|63&o)):o<55296||o>=57344?(e.setUint8(t++,224|o>>12),e.setUint8(t++,128|o>>6&63),e.setUint8(t++,128|63&o)):(r++,o=65536+((1023&o)<<10|1023&n.charCodeAt(r)),e.setUint8(t++,240|o>>18),e.setUint8(t++,128|o>>12&63),e.setUint8(t++,128|o>>6&63),e.setUint8(t++,128|63&o))}function O(e,t,n){var o=typeof n,r=0,i=0,s=0,a=0,c=0,u=0;if("string"===o){if(c=function(e){for(var t=0,n=0,o=0,r=e.length;o<r;o++)(t=e.charCodeAt(o))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(o++,n+=4);return n}(n),c<32)e.push(160|c),u=1;else if(c<256)e.push(217,c),u=2;else if(c<65536)e.push(218,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("String too long");e.push(219,c>>24,c>>16,c>>8,c),u=5}return t.push({_str:n,_length:c,_offset:e.length}),u+c}if("number"===o)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(e.push(n),1):n<256?(e.push(204,n),2):n<65536?(e.push(205,n>>8,n),3):n<4294967296?(e.push(206,n>>24,n>>16,n>>8,n),5):(s=n/Math.pow(2,32)>>0,a=n>>>0,e.push(207,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),9):n>=-32?(e.push(n),1):n>=-128?(e.push(208,n),2):n>=-32768?(e.push(209,n>>8,n),3):n>=-2147483648?(e.push(210,n>>24,n>>16,n>>8,n),5):(s=Math.floor(n/Math.pow(2,32)),a=n>>>0,e.push(211,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),9):(e.push(203),t.push({_float:n,_length:8,_offset:e.length}),9);if("object"===o){if(null===n)return e.push(192),1;if(Array.isArray(n)){if((c=n.length)<16)e.push(144|c),u=1;else if(c<65536)e.push(220,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Array too large");e.push(221,c>>24,c>>16,c>>8,c),u=5}for(r=0;r<c;r++)u+=O(e,t,n[r]);return u}if(n instanceof Date){var h=n.getTime(),f=Math.floor(h/1e3),d=1e6*(h-1e3*f);return f>=0&&d>=0&&f<=w?0===d&&f<=_?(e.push(214,255,f>>24,f>>16,f>>8,f),6):(s=f/4294967296,a=4294967295&f,e.push(215,255,d>>22,d>>14,d>>6,s,a>>24,a>>16,a>>8,a),10):(s=Math.floor(f/4294967296),a=f>>>0,e.push(199,12,255,d>>24,d>>16,d>>8,d,s>>24,s>>16,s>>8,s,a>>24,a>>16,a>>8,a),15)}if(n instanceof ArrayBuffer){if((c=n.byteLength)<256)e.push(196,c),u=2;else if(c<65536)e.push(197,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Buffer too large");e.push(198,c>>24,c>>16,c>>8,c),u=5}return t.push({_bin:n,_length:c,_offset:e.length}),u+c}if("function"==typeof n.toJSON)return O(e,t,n.toJSON());var l=[],p="",y=Object.keys(n);for(r=0,i=y.length;r<i;r++)void 0!==n[p=y[r]]&&"function"!=typeof n[p]&&l.push(p);if((c=l.length)<16)e.push(128|c),u=1;else if(c<65536)e.push(222,c>>8,c),u=3;else{if(!(c<4294967296))throw new Error("Object too large");e.push(223,c>>24,c>>16,c>>8,c),u=5}for(r=0;r<c;r++)u+=O(e,t,p=l[r]),u+=O(e,t,n[p]);return u}if("boolean"===o)return e.push(n?195:194),1;if("undefined"===o)return e.push(192),1;if("function"==typeof n.toJSON)return O(e,t,n.toJSON());throw new Error("Could not encode")}function A(e){var t=[],n=[],o=O(t,n,e),r=new ArrayBuffer(o),i=new DataView(r),s=0,a=0,c=-1;n.length>0&&(c=n[0]._offset);for(var u,h=0,f=0,d=0,l=t.length;d<l;d++)if(i.setUint8(a+d,t[d]),d+1===c){if(h=(u=n[s])._length,f=a+c,u._bin)for(var p=new Uint8Array(u._bin),y=0;y<h;y++)i.setUint8(f+y,p[y]);else u._str?E(i,f,u._str):void 0!==u._float&&i.setFloat64(f,u._float);a+=h,n[++s]&&(c=n[s]._offset)}return r}var I,$,T=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},R=function(){function e(e){this.events=e}return e.prototype.send=function(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)},e.prototype.connect=function(e){this.ws=new T(e,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},e.prototype.close=function(e,t){this.ws.close(e,t)},Object.defineProperty(e.prototype,"isOpen",{get:function(){return this.ws.readyState===T.OPEN},enumerable:!1,configurable:!0}),e}(),x=function(){function e(){this.events={},this.transport=new R(this.events)}return e.prototype.send=function(e){this.transport.send(e)},e.prototype.connect=function(e){this.transport.connect(e)},e.prototype.close=function(e,t){this.transport.close(e,t)},Object.defineProperty(e.prototype,"isOpen",{get:function(){return this.transport.isOpen},enumerable:!1,configurable:!0}),e}();function P(e,t){for(var n=e[t++],o="",r=0,i=t,s=t+n;i<s;i++){var a=e[i];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(r=(7&a)<<18|(63&e[++i])<<12|(63&e[++i])<<6|(63&e[++i])<<0)>=65536?(r-=65536,o+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):o+=String.fromCharCode(r)}else o+=String.fromCharCode((15&a)<<12|(63&e[++i])<<6|(63&e[++i])<<0);else o+=String.fromCharCode((31&a)<<6|63&e[++i]);else o+=String.fromCharCode(a)}return o}function S(e){void 0===e&&(e="");for(var t=0,n=0,o=0,r=e.length;o<r;o++)(t=e.charCodeAt(o))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(o++,n+=4);return n+1}e.Protocol=void 0,(I=e.Protocol||(e.Protocol={}))[I.HANDSHAKE=9]="HANDSHAKE",I[I.JOIN_ROOM=10]="JOIN_ROOM",I[I.ERROR=11]="ERROR",I[I.LEAVE_ROOM=12]="LEAVE_ROOM",I[I.ROOM_DATA=13]="ROOM_DATA",I[I.ROOM_STATE=14]="ROOM_STATE",I[I.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",I[I.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",I[I.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES",e.ErrorCode=void 0,($=e.ErrorCode||(e.ErrorCode={}))[$.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",$[$.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",$[$.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",$[$.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",$[$.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",$[$.AUTH_FAILED=4215]="AUTH_FAILED",$[$.APPLICATION_ERROR=4216]="APPLICATION_ERROR";var k={};function C(e,t){k[e]=t}function D(e){var t=k[e];if(!t)throw new Error("missing serializer: "+e);return t}let N=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}});var M=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return this.handlers.push(e),this},e.prototype.invoke=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.handlers.forEach((function(n){return n.apply(e,t)}))},e.prototype.invokeAsync=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.all(this.handlers.map((function(n){return n.apply(e,t)})))},e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}();function L(){var e=new M;function t(t){return e.register(t,null===this)}return t.once=function(t){var n=function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];t.apply(this,o),e.remove(n)};e.register(n)},t.remove=function(t){return e.remove(t)},t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)},t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)},t.clear=function(){return e.clear()},t}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var j,V,U,H,F=(j=function(e,t){!function(e){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}function o(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function r(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var i,s=255;e.OPERATION=void 0,(i=e.OPERATION||(e.OPERATION={}))[i.ADD=128]="ADD",i[i.REPLACE=0]="REPLACE",i[i.DELETE=64]="DELETE",i[i.DELETE_AND_ADD=192]="DELETE_AND_ADD",i[i.TOUCH=1]="TOUCH",i[i.CLEAR=10]="CLEAR";var a=function(){function t(e,t,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(t,n)}return t.prototype.setParent=function(e,t,n){var o=this;if(this.indexes||(this.indexes=this.ref instanceof ue?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=n,t)if(this.root=t,this.ref instanceof ue){var r=this.ref._definition;for(var i in r.schema){var s=this.ref[i];if(s&&s.$changes){var a=r.indexes[i];s.$changes.setParent(this.ref,t,a)}}}else"object"==typeof this.ref&&this.ref.forEach((function(e,t){if(e instanceof ue){var n=e.$changes,r=o.ref.$changes.indexes[t];n.setParent(o.ref,o.root,r)}}))},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(t,n){void 0===n&&(n=e.OPERATION.ADD);var o="number"==typeof t?t:this.indexes[t];this.assertValidIndex(o,t);var r=this.changes.get(o);r&&r.op!==e.OPERATION.DELETE&&r.op!==e.OPERATION.TOUCH||this.changes.set(o,{op:r&&r.op===e.OPERATION.DELETE?e.OPERATION.DELETE_AND_ADD:n,index:o}),this.allChanges.add(o),this.changed=!0,this.touchParents()},t.prototype.touch=function(t){var n="number"==typeof t?t:this.indexes[t];this.assertValidIndex(n,t),this.changes.has(n)||this.changes.set(n,{op:e.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition)return(t=this.ref._definition).schema[t.fieldsByIndex[e]];var t,n=(t=this.parent._definition).schema[t.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(t){var n="number"==typeof t?t:this.indexes[t];if(void 0!==n){var o=this.getValue(n);this.changes.set(n,{op:e.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],o&&o.$changes&&(o.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(t," (").concat(n,")"))},t.prototype.discard=function(t,n){var o=this;void 0===t&&(t=!1),void 0===n&&(n=!1),this.ref instanceof ue||this.changes.forEach((function(t){if(t.op===e.OPERATION.DELETE){var n=o.ref.getIndex(t.index);delete o.indexes[n]}})),this.changes.clear(),this.changed=t,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach((function(t){var n=e.getValue(t.index);n&&n.$changes&&n.$changes.discardAll()})),this.discard()},t.prototype.cache=function(e,t){this.caches[e]=t},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,t){if(void 0===e)throw new Error('ChangeTree: missing index for field "'.concat(t,'"'))},t}();function c(e,t,n,o){return e[t]||(e[t]=[]),e[t].push(n),null==o||o.forEach((function(e,t){return n(e,t)})),function(){return h(e[t],e[t].indexOf(n))}}function u(t){var n=this,o="string"!=typeof this.$changes.getType();this.$items.forEach((function(r,i){t.push({refId:n.$changes.refId,op:e.OPERATION.DELETE,field:i,value:void 0,previousValue:r}),o&&n.$changes.root.removeRef(r.$changes.refId)}))}function h(e,t){if(-1===t||t>=e.length)return!1;for(var n=e.length-1,o=t;o<n;o++)e[o]=e[o+1];return e.length=n,!0}var f=function(e,t){var n=e.toString(),o=t.toString();return n<o?-1:n>o?1:0};var d=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},t.is=function(e){return Array.isArray(e)||void 0!==e.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e,t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return n.forEach((function(n){e=t.$refId++,t.setAt(e,n)})),e},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e),this.$indexes.delete(e);var t=this.$items.get(e);return this.$items.delete(e),t}},t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},t.prototype.setAt=function(t,n){var o,r;void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,t);var i=null!==(r=null===(o=this.$changes.indexes[t])||void 0===o?void 0:o.op)&&void 0!==r?r:e.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,n),this.$changes.change(t,i)},t.prototype.deleteAt=function(e){var t=Array.from(this.$items.keys())[e];return void 0!==t&&this.$deleteAt(t)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&u.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new(t.bind.apply(t,r([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n),!1)))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,t=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(n,o){e.setAt(t[o],n)})),this},t.prototype.shift=function(){var e=Array.from(this.$items.keys()).shift();if(void 0!==e){var t=this.$items.get(e);return this.$deleteAt(e),t}},t.prototype.slice=function(e,n){var o=new t;return o.push.apply(o,Array.from(this.$items.values()).slice(e,n)),o},t.prototype.sort=function(e){var t=this;void 0===e&&(e=f);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(e).forEach((function(e,o){t.setAt(n[o],e)})),this},t.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var n=Array.from(this.$items.keys()),o=[],r=e;r<e+t;r++)o.push(this.$items.get(n[r])),this.$deleteAt(n[r]);return o},t.prototype.unshift=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=this.length,r=t.length,i=Array.from(this.$items.values());return t.forEach((function(t,n){e.setAt(n,t)})),i.forEach((function(t,n){e.setAt(r+n,t)})),o+r},t.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)},t.prototype.lastIndexOf=function(e,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,t)},t.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)},t.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)},t.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)},t.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)},t.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)},t.prototype.reduce=function(e,t){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},t.prototype.reduceRight=function(e,t){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},t.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)},t.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)},t.prototype.fill=function(e,t,n){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,t,n){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)},t.prototype.flatMap=function(e,t){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.findLast=function(){var e=Array.from(this.$items.values());return e.findLast.apply(e,arguments)},t.prototype.findLastIndex=function(){var e=Array.from(this.$items.values());return e.findLastIndex.apply(e,arguments)},t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map((function(e){return"function"==typeof e.toJSON?e.toJSON():e}))},t.prototype.clone=function(e){return e?new(t.bind.apply(t,r([void 0],Array.from(this.$items.values()),!1))):new(t.bind.apply(t,r([void 0],this.map((function(e){return e.$changes?e.clone():e})),!1)))},t}();var l=function(){function t(e){var n=this;if(this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map||e instanceof t)e.forEach((function(e,t){return n.set(t,e)}));else for(var o in e)this.set(o,e[o])}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),t.prototype.set=function(t,n){if(null==n)throw new Error("MapSchema#set('".concat(t,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(t,"'."));var o=void 0!==this.$changes.indexes[t],r=o?this.$changes.indexes[t]:this.$refId++,i=o?e.OPERATION.REPLACE:e.OPERATION.ADD,s=void 0!==n.$changes;return s&&n.$changes.setParent(this,this.$changes.root,r),o?s&&this.$items.get(t)!==n&&(i=e.OPERATION.ADD):(this.$changes.indexes[t]=r,this.$indexes.set(r,t)),this.$items.set(t,n),this.$changes.change(t,i),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&u.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach((function(t,n){e[n]="function"==typeof t.toJSON?t.toJSON():t})),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach((function(e,t){e.$changes?n.set(t,e.clone()):n.set(t,e)}))),n},t}(),p={};function y(e,t){p[e]=t}function g(e){return p[e]}var v=function(){function e(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return e.create=function(t){var n=new e;return n.schema=Object.assign({},t&&t.schema||{}),n.indexes=Object.assign({},t&&t.indexes||{}),n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),n.descriptors=Object.assign({},t&&t.descriptors||{}),n.deprecated=Object.assign({},t&&t.deprecated||{}),n},e.prototype.addField=function(e,t){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=e,this.indexes[e]=n,this.schema[e]=Array.isArray(t)?{array:t[0]}:t},e.prototype.hasField=function(e){return void 0!==this.indexes[e]},e.prototype.addFilter=function(e,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=t,this.indexesWithFilters.push(this.indexes[e]),!0},e.prototype.addChildrenFilter=function(e,t){var n=this.indexes[e],o=this.schema[e];if(g(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=t,!0;console.warn("@filterChildren: field '".concat(e,"' can't have children. Ignoring filter."))},e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},e}();var m=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size),e._definition=v.create(e._definition),e._typeid=t,this.types[t]=e,this.schemas.set(e,t)},e.create=function(t){return void 0===t&&(t={}),function(n){return t.context||(t.context=new e),_(n,t)}},e}(),b=new m;function _(e,t){return void 0===t&&(t={}),function(n,o){var i=t.context||b,s=n.constructor;if(s._context=i,!e)throw new Error("".concat(s.name,': @type() reference provided for "').concat(o,"\" is undefined. Make sure you don't have any circular dependencies."));i.has(s)||i.add(s);var a=s._definition;if(a.addField(o,e),a.descriptors[o]){if(a.deprecated[o])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(o,"' definition on '").concat(s.name,"'.\nCheck @type() annotation"))}catch(e){var c=e.stack.split("\n")[4].trim();throw new Error("".concat(e.message," ").concat(c))}}var u=d.is(e),h=!u&&l.is(e);if("string"!=typeof e&&!ue.is(e)){var f=Object.values(e)[0];"string"==typeof f||i.has(f)||i.add(f)}if(t.manual)a.descriptors[o]={enumerable:!0,configurable:!0,writable:!0};else{var p="_".concat(o);a.descriptors[p]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[o]={get:function(){return this[p]},set:function(e){e!==this[p]&&(null!=e?(!u||e instanceof d||(e=new(d.bind.apply(d,r([void 0],e,!1)))),!h||e instanceof l||(e=new l(e)),void 0===e.$proxy&&(h?e=function(e){return e.$proxy=!0,new Proxy(e,{get:function(e,t){return"symbol"!=typeof t&&void 0===e[t]?e.get(t):e[t]},set:function(e,t,n){return"symbol"!=typeof t&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,n):e[t]=n,!0},deleteProperty:function(e,t){return e.delete(t),!0}})}(e):u&&(e=function(e){return e.$proxy=!0,new Proxy(e,{get:function(e,t){return"symbol"==typeof t||isNaN(t)?e[t]:e.at(t)},set:function(e,t,n){if("symbol"==typeof t||isNaN(t))e[t]=n;else{var o=Array.from(e.$items.keys()),r=parseInt(o[t]||t);null==n?e.deleteAt(r):e.setAt(r,n)}return!0},deleteProperty:function(e,t){return"number"==typeof t?e.deleteAt(t):delete e[t],!0}})}(e))),this.$changes.change(o),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[o])):this[p]&&this.$changes.delete(o),this[p]=e)},enumerable:!0,configurable:!0}}}}function w(e,t,n){for(var o=0,r=0,i=n.length;r<i;r++)(o=n.charCodeAt(r))<128?e[t++]=o:o<2048?(e[t++]=192|o>>6,e[t++]=128|63&o):o<55296||o>=57344?(e[t++]=224|o>>12,e[t++]=128|o>>6&63,e[t++]=128|63&o):(r++,o=65536+((1023&o)<<10|1023&n.charCodeAt(r)),e[t++]=240|o>>18,e[t++]=128|o>>12&63,e[t++]=128|o>>6&63,e[t++]=128|63&o)}function E(e,t){e.push(255&t)}function O(e,t){e.push(255&t)}function A(e,t){e.push(255&t),e.push(t>>8&255)}function I(e,t){e.push(255&t),e.push(t>>8&255)}function $(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function T(e,t){var n=t>>24,o=t>>16,r=t>>8,i=t;e.push(255&i),e.push(255&r),e.push(255&o),e.push(255&n)}function R(e,t){var n=Math.floor(t/Math.pow(2,32));T(e,t>>>0),T(e,n)}function x(e,t){var n=t/Math.pow(2,32)>>0;T(e,t>>>0),T(e,n)}var P=new Int32Array(2),S=new Float32Array(P.buffer),k=new Float64Array(P.buffer);function C(e,t){S[0]=t,$(e,P[0])}function D(e,t){k[0]=t,$(e,P[0]),$(e,P[1])}function N(e,t){t||(t="");var n=function(e){for(var t=0,n=0,o=0,r=e.length;o<r;o++)(t=e.charCodeAt(o))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(o++,n+=4);return n}(t),o=0;if(n<32)e.push(160|n),o=1;else if(n<256)e.push(217),O(e,n),o=2;else if(n<65536)e.push(218),I(e,n),o=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219),T(e,n),o=5}return w(e,e.length,t),o+n}function M(e,t){return isNaN(t)?M(e,0):isFinite(t)?t!==(0|t)?(e.push(203),D(e,t),9):t>=0?t<128?(O(e,t),1):t<256?(e.push(204),O(e,t),2):t<65536?(e.push(205),I(e,t),3):t<4294967296?(e.push(206),T(e,t),5):(e.push(207),x(e,t),9):t>=-32?(e.push(224|t+32),1):t>=-128?(e.push(208),E(e,t),2):t>=-32768?(e.push(209),A(e,t),3):t>=-2147483648?(e.push(210),$(e,t),5):(e.push(211),R(e,t),9):M(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var L=Object.freeze({__proto__:null,utf8Write:w,int8:E,uint8:O,int16:A,uint16:I,int32:$,uint32:T,int64:R,uint64:x,float32:function(e,t){C(e,t)},float64:function(e,t){D(e,t)},writeFloat32:C,writeFloat64:D,boolean:function(e,t){return O(e,t?1:0)},string:N,number:M});function j(e,t){return V(e,t)<<24>>24}function V(e,t){return e[t.offset++]}function U(e,t){return H(e,t)<<16>>16}function H(e,t){return e[t.offset++]|e[t.offset++]<<8}function F(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function B(e,t){return F(e,t)>>>0}function J(e,t){var n=B(e,t);return F(e,t)*Math.pow(2,32)+n}function q(e,t){var n=B(e,t);return B(e,t)*Math.pow(2,32)+n}var Z=new Int32Array(2),z=new Float32Array(Z.buffer),K=new Float64Array(Z.buffer);function G(e,t){return Z[0]=F(e,t),z[0]}function Y(e,t){return Z[0]=F(e,t),Z[1]=F(e,t),K[0]}function W(e,t){var n,o=e[t.offset++];o<192?n=31&o:217===o?n=V(e,t):218===o?n=H(e,t):219===o&&(n=B(e,t));var r=function(e,t,n){for(var o="",r=0,i=t,s=t+n;i<s;i++){var a=e[i];0!=(128&a)?192!=(224&a)?224!=(240&a)?240!=(248&a)?console.error("Invalid byte "+a.toString(16)):(r=(7&a)<<18|(63&e[++i])<<12|(63&e[++i])<<6|(63&e[++i])<<0)>=65536?(r-=65536,o+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):o+=String.fromCharCode(r):o+=String.fromCharCode((15&a)<<12|(63&e[++i])<<6|(63&e[++i])<<0):o+=String.fromCharCode((31&a)<<6|63&e[++i]):o+=String.fromCharCode(a)}return o}(e,t.offset,n);return t.offset+=n,r}function X(e,t){var n=e[t.offset++];return n<128?n:202===n?G(e,t):203===n?Y(e,t):204===n?V(e,t):205===n?H(e,t):206===n?B(e,t):207===n?q(e,t):208===n?j(e,t):209===n?U(e,t):210===n?F(e,t):211===n?J(e,t):n>223?-1*(255-n+1):void 0}function Q(e,t){return e[t.offset-1]===s&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}var ee=Object.freeze({__proto__:null,int8:j,uint8:V,int16:U,uint16:H,int32:F,uint32:B,float32:function(e,t){return G(e,t)},float64:function(e,t){return Y(e,t)},int64:J,uint64:q,readFloat32:G,readFloat64:Y,boolean:function(e,t){return V(e,t)>0},string:W,stringCheck:function(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n},number:X,numberCheck:function(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211},arrayCheck:function(e,t){return e[t.offset]<160},switchStructureCheck:Q}),te=function(){function t(e){var t=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return t.add(e)}))}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},t.is=function(e){return void 0!==e.collection},t.prototype.add=function(e){var t=this.$refId++;return void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t),t},t.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,o=this.$items.entries();(n=o.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&u.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some((function(t){return t===e}))},t.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,o,r){return e(n,o,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach((function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)})),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach((function(e){e.$changes?n.add(e.clone()):n.add(e)}))),n},t}(),ne=function(){function t(e){var t=this;this.$changes=new a(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach((function(e){return t.add(e)}))}return t.prototype.onAdd=function(t,n){return void 0===n&&(n=!0),c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.ADD,t,n?this.$items:void 0)},t.prototype.onRemove=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},t.is=function(e){return void 0!==e.set},t.prototype.add=function(t){var n,o;if(this.has(t))return!1;var r=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,r);var i=null!==(o=null===(n=this.$changes.indexes[r])||void 0===n?void 0:n.op)&&void 0!==o?o:e.OPERATION.ADD;return this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,t),this.$changes.change(r,i),r},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var t,n,o=this.$items.entries();(n=o.next())&&!n.done;)if(e===n.value[1]){t=n.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&u.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:e.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var t,n=this.$items.values(),o=!1;(t=n.next())&&!t.done;)if(e===t.value){o=!0;break}return o},t.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,o,r){return e(n,o,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach((function(t,n){e.push("function"==typeof t.toJSON?t.toJSON():t)})),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach((function(e){e.$changes?n.add(e.clone()):n.add(e)}))),n},t}(),oe=function(){function e(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return e.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},e.get=function(t){return void 0===t.$filterState&&(t.$filterState=new e),t.$filterState},e}(),re=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(e,t,n){void 0===n&&(n=!0),this.refs.set(e,t),n&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach((function(t){if(!(e.refCounts[t]>0)){var n=e.refs.get(t);if(n instanceof ue)for(var o in n._definition.schema)"string"!=typeof n._definition.schema[o]&&n[o]&&n[o].$changes&&e.removeRef(n[o].$changes.refId);else{var r=n.$changes.parent._definition,i=r.schema[r.fieldsByIndex[n.$changes.parentIndex]];"function"==typeof Object.values(i)[0]&&Array.from(n.values()).forEach((function(t){return e.removeRef(t.$changes.refId)}))}e.refs.delete(t),delete e.refCounts[t]}})),this.deletedRefs.clear()},e}(),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(Error);function se(e,t,n,o){if(!(e instanceof t))throw new ie("a '".concat(t.name,"' was expected, but '").concat(e.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(o))}function ae(e,t,n,o,r){!function(e,t,n,o){var r,i=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":r="number",isNaN(e)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(o));break;case"string":r="string",i=!0;break;case"boolean":return}if(typeof e!==r&&(!i||i&&null!==e)){var s="'".concat(JSON.stringify(e),"'").concat(e&&e.constructor&&" (".concat(e.constructor.name,")")||"");throw new ie("a '".concat(r,"' was expected, but ").concat(s," was provided in ").concat(n.constructor.name,"#").concat(o))}}(n,e,o,r);var i=L[e];if(!i)throw new ie("a '".concat(e,"' was expected, but ").concat(n," was provided in ").concat(o.constructor.name,"#").concat(r));i(t,n)}function ce(e,t,n){return ee[e](t,n)}var ue=function(){function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new a(this,void 0,new re),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&void 0!==e._definition.schema},t.prototype.onChange=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.REPLACE,t)},t.prototype.onRemove=function(t){return c(this.$callbacks||(this.$callbacks=[]),e.OPERATION.DELETE,t)},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.setDirty=function(e,t){this.$changes.change(e,t)},t.prototype.listen=function(e,t,n){var o=this;return void 0===n&&(n=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[e]||(this.$callbacks[e]=[]),this.$callbacks[e].push(t),n&&void 0!==this[e]&&t(this[e],void 0),function(){return h(o.$callbacks[e],o.$callbacks[e].indexOf(t))}},t.prototype.decode=function(n,o,r){var i;void 0===o&&(o={offset:0}),void 0===r&&(r=this);var a=[],c=this.$changes.root,u=n.length,h=0;for(c.refs.set(h,this);o.offset<u;){var f=n[o.offset++];if(f!=s){var p=r.$changes,y=void 0!==r._definition,v=y?f>>6<<6:f;if(v!==e.OPERATION.CLEAR){var m=y?f%(v||255):X(n,o),b=y?r._definition.fieldsByIndex[m]:"",_=p.getType(m),w=void 0,E=void 0,O=void 0;if(y?E=r["_".concat(b)]:(E=r.getByIndex(m),(v&e.OPERATION.ADD)===e.OPERATION.ADD?(O=r instanceof l?W(n,o):m,r.setIndex(m,O)):O=r.getIndex(m)),(v&e.OPERATION.DELETE)===e.OPERATION.DELETE&&(v!==e.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(m),E&&E.$changes&&c.removeRef(E.$changes.refId),w=null),void 0!==b){if(v===e.OPERATION.DELETE);else if(t.is(_)){var A=X(n,o);if(w=c.refs.get(A),v!==e.OPERATION.REPLACE){var I=this.getSchemaType(n,o,_);w||((w=this.createTypeInstance(I)).$changes.refId=A,E&&(w.$callbacks=E.$callbacks,E.$changes.refId&&A!==E.$changes.refId&&c.removeRef(E.$changes.refId))),c.addRef(A,w,w!==E)}}else if("string"==typeof _)w=ce(_,n,o);else{var $=g(Object.keys(_)[0]),T=X(n,o),R=c.refs.has(T)?E||c.refs.get(T):new $.constructor;if((w=R.clone(!0)).$changes.refId=T,E&&(w.$callbacks=E.$callbacks,E.$changes.refId&&T!==E.$changes.refId)){c.removeRef(E.$changes.refId);for(var x=E.entries(),P=void 0;(P=x.next())&&!P.done;){var S=(i=P.value)[0],k=i[1];a.push({refId:T,op:e.OPERATION.DELETE,field:S,value:void 0,previousValue:k})}}c.addRef(T,w,R!==E)}if(null!=w)if(w.$changes&&w.$changes.setParent(p.ref,p.root,m),r instanceof t)r[b]=w;else if(r instanceof l)S=O,r.$items.set(S,w),r.$changes.allChanges.add(m);else if(r instanceof d)r.setAt(m,w);else if(r instanceof te){var C=r.add(w);r.setIndex(m,C)}else r instanceof ne&&!1!==(C=r.add(w))&&r.setIndex(m,C);E!==w&&a.push({refId:h,op:v,field:b,dynamicIndex:O,value:w,previousValue:E})}else{console.warn("@colyseus/schema: definition mismatch");for(var D={offset:o.offset};o.offset<u&&(!Q(n,o)||(D.offset=o.offset+1,!c.refs.has(X(n,D))));)o.offset++}}else r.clear(a)}else{h=X(n,o);var N=c.refs.get(h);if(!N)throw new Error('"refId" not found: '.concat(h));r=N}}return this._triggerChanges(a),c.garbageCollectDeletedRefs(),a},t.prototype.encode=function(n,o,r){void 0===n&&(n=!1),void 0===o&&(o=[]),void 0===r&&(r=!1);for(var i=this.$changes,a=new WeakSet,c=[i],u=1,h=0;h<u;h++){var f=c[h],d=f.ref,p=d instanceof t;f.ensureRefId(),a.add(f),f!==i&&(f.changed||n)&&(O(o,s),M(o,f.refId));for(var y=n?Array.from(f.allChanges):Array.from(f.changes.values()),v=0,m=y.length;v<m;v++){var b=n?{op:e.OPERATION.ADD,index:y[v]}:y[v],_=b.index,w=p?d._definition.fieldsByIndex&&d._definition.fieldsByIndex[_]:_,E=o.length;if(b.op!==e.OPERATION.TOUCH)if(p)O(o,_|b.op);else{if(O(o,b.op),b.op===e.OPERATION.CLEAR)continue;M(o,_)}if(p||(b.op&e.OPERATION.ADD)!=e.OPERATION.ADD||d instanceof l&&N(o,f.ref.$indexes.get(_)),b.op!==e.OPERATION.DELETE){var A=f.getType(_),I=f.getValue(_);if(I&&I.$changes&&!a.has(I.$changes)&&(c.push(I.$changes),I.$changes.ensureRefId(),u++),b.op!==e.OPERATION.TOUCH){if(t.is(A))se(I,A,d,w),M(o,I.$changes.refId),(b.op&e.OPERATION.ADD)===e.OPERATION.ADD&&this.tryEncodeTypeId(o,A,I.constructor);else if("string"==typeof A)ae(A,o,I,d,w);else{var $=g(Object.keys(A)[0]);se(d["_".concat(w)],$.constructor,d,w),M(o,I.$changes.refId)}r&&f.cache(_,o.slice(E))}}}n||r||f.discard()}return o},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(n,o){var r,i;void 0===o&&(o=!1);for(var a=this,c=new Set,u=oe.get(n),h=[this.$changes],f=1,d=[],p=function(p){var y=h[p];if(c.has(y.refId))return"continue";var g=y.ref,v=g instanceof t;O(d,s),M(d,y.refId);var m=u.refIds.has(y),b=o||!m;u.addRefId(y);var _=u.containerIndexes.get(y),w=b?Array.from(y.allChanges):Array.from(y.changes.values());!o&&v&&g._definition.indexesWithFilters&&g._definition.indexesWithFilters.forEach((function(t){!_.has(t)&&y.allChanges.has(t)&&(b?w.push(t):w.push({op:e.OPERATION.ADD,index:t}))}));for(var E=0,A=w.length;E<A;E++){var I=b?{op:e.OPERATION.ADD,index:w[E]}:w[E];if(I.op!==e.OPERATION.CLEAR){var $=I.index;if(I.op!==e.OPERATION.DELETE){var T=y.getValue($),R=y.getType($);if(v){if((x=g._definition.filters&&g._definition.filters[$])&&!x.call(g,n,T,a)){T&&T.$changes&&c.add(T.$changes.refId);continue}}else{var x,P=y.parent;if((x=y.getChildrenFilter())&&!x.call(P,n,g.$indexes.get($),T,a)){T&&T.$changes&&c.add(T.$changes.refId);continue}}if(T.$changes&&(h.push(T.$changes),f++),I.op!==e.OPERATION.TOUCH)if(I.op===e.OPERATION.ADD||v)d.push.apply(d,null!==(r=y.caches[$])&&void 0!==r?r:[]),_.add($);else if(_.has($))d.push.apply(d,null!==(i=y.caches[$])&&void 0!==i?i:[]);else{if(_.add($),O(d,e.OPERATION.ADD),M(d,$),g instanceof l){var S=y.ref.$indexes.get($);N(d,S)}T.$changes?M(d,T.$changes.refId):L[R](d,T)}else T.$changes&&!v&&(O(d,e.OPERATION.ADD),M(d,$),g instanceof l&&(S=y.ref.$indexes.get($),N(d,S)),M(d,T.$changes.refId))}else v?O(d,I.op|$):(O(d,I.op),M(d,$))}else O(d,I.op)}},y=0;y<f;y++)p(y);return d},t.prototype.clone=function(){var e,t=new this.constructor,n=this._definition.schema;for(var o in n)"object"==typeof this[o]&&"function"==typeof(null===(e=this[o])||void 0===e?void 0:e.clone)?t[o]=this[o].clone():t[o]=this[o];return t},t.prototype.toJSON=function(){var e=this._definition.schema,t=this._definition.deprecated,n={};for(var o in e)t[o]||null===this[o]||void 0===this[o]||(n[o]="function"==typeof this[o].toJSON?this[o].toJSON():this["_".concat(o)]);return n},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,t,n){t._typeid!==n._typeid&&(O(e,213),M(e,n._typeid))},t.prototype.getSchemaType=function(e,t,n){var o;return 213===e[t.offset]&&(t.offset++,o=this.constructor._context.get(X(e,t))),o||n},t.prototype.createTypeInstance=function(e){var t=new e;return t.$changes.root=this.$changes.root,t},t.prototype._triggerChanges=function(n){for(var o,r,i,s,a,c,u,h,f,d=new Set,l=this.$changes.root.refs,p=function(p){var y=n[p],g=y.refId,v=l.get(g),m=v.$callbacks;if((y.op&e.OPERATION.DELETE)===e.OPERATION.DELETE&&y.previousValue instanceof t&&(null===(r=null===(o=y.previousValue.$callbacks)||void 0===o?void 0:o[e.OPERATION.DELETE])||void 0===r||r.forEach((function(e){return e()}))),!m)return"continue";if(v instanceof t){if(!d.has(g))try{null===(i=null==m?void 0:m[e.OPERATION.REPLACE])||void 0===i||i.forEach((function(e){return e(n)}))}catch(e){t.onError(e)}try{m.hasOwnProperty(y.field)&&(null===(s=m[y.field])||void 0===s||s.forEach((function(e){return e(y.value,y.previousValue)})))}catch(e){t.onError(e)}}else y.op===e.OPERATION.ADD&&void 0===y.previousValue?null===(a=m[e.OPERATION.ADD])||void 0===a||a.forEach((function(e){var t;return e(y.value,null!==(t=y.dynamicIndex)&&void 0!==t?t:y.field)})):y.op===e.OPERATION.DELETE?void 0!==y.previousValue&&(null===(c=m[e.OPERATION.DELETE])||void 0===c||c.forEach((function(e){var t;return e(y.previousValue,null!==(t=y.dynamicIndex)&&void 0!==t?t:y.field)}))):y.op===e.OPERATION.DELETE_AND_ADD&&(void 0!==y.previousValue&&(null===(u=m[e.OPERATION.DELETE])||void 0===u||u.forEach((function(e){var t;return e(y.previousValue,null!==(t=y.dynamicIndex)&&void 0!==t?t:y.field)}))),null===(h=m[e.OPERATION.ADD])||void 0===h||h.forEach((function(e){var t;return e(y.value,null!==(t=y.dynamicIndex)&&void 0!==t?t:y.field)}))),y.value!==y.previousValue&&(null===(f=m[e.OPERATION.REPLACE])||void 0===f||f.forEach((function(e){var t;return e(y.value,null!==(t=y.dynamicIndex)&&void 0!==t?t:y.field)})));d.add(g)},y=0;y<n.length;y++)p(y)},t._definition=v.create(),t}();var he={context:new m},fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),o([_("string",he)],t.prototype,"name",void 0),o([_("string",he)],t.prototype,"type",void 0),o([_("number",he)],t.prototype,"referencedType",void 0),t}(ue),de=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new d,t}return n(t,e),o([_("number",he)],t.prototype,"id",void 0),o([_([fe],he)],t.prototype,"fields",void 0),t}(ue),le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new d,t}return n(t,e),t.encode=function(e){var n=e.constructor,o=new t;o.rootType=n._typeid;var r=function(e,t){for(var n in t){var r=new fe;r.name=n;var i=void 0;if("string"==typeof t[n])i=t[n];else{var s=t[n],a=void 0;ue.is(s)?(i="ref",a=t[n]):"string"==typeof s[i=Object.keys(s)[0]]?i+=":"+s[i]:a=s[i],r.referencedType=a?a._typeid:-1}r.type=i,e.fields.push(r)}o.types.push(e)},i=n._context.types;for(var s in i){var a=new de;a.id=Number(s),r(a,i[s]._definition.schema)}return o.encodeAll()},t.decode=function(e,o){var r=new m,i=new t;i.decode(e,o);var s=i.types.reduce((function(e,t){var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(ue),i=t.id;return e[i]=o,r.add(o,i),e}),{});i.types.forEach((function(e){var t=s[e.id];e.fields.forEach((function(e){var n;if(void 0!==e.referencedType){var o=e.type,i=s[e.referencedType];if(!i){var a=e.type.split(":");o=a[0],i=a[1]}"ref"===o?_(i,{context:r})(t.prototype,e.name):_(((n={})[o]=i,n),{context:r})(t.prototype,e.name)}else _(e.type,{context:r})(t.prototype,e.name)}))}));var a=s[i.rootType],c=new a;for(var u in a._definition.schema){var h=a._definition.schema[u];"string"!=typeof h&&(c[u]="function"==typeof h?new h:new(g(Object.keys(h)[0]).constructor))}return c},o([_([de],he)],t.prototype,"types",void 0),o([_("number",he)],t.prototype,"rootType",void 0),t}(ue);y("map",{constructor:l}),y("array",{constructor:d}),y("set",{constructor:ne}),y("collection",{constructor:te}),e.ArraySchema=d,e.CollectionSchema=te,e.Context=m,e.MapSchema=l,e.Reflection=le,e.ReflectionField=fe,e.ReflectionType=de,e.Schema=ue,e.SchemaDefinition=v,e.SetSchema=ne,e.decode=ee,e.defineTypes=function(e,t,n){for(var o in void 0===n&&(n={}),n.context||(n.context=e._context||n.context||b),t)_(t[o],n)(e.prototype,o);return e},e.deprecated=function(e){return void 0===e&&(e=!0),function(t,n){var o=t.constructor._definition;o.deprecated[n]=!0,e&&(o.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(e){},enumerable:!1,configurable:!0})}},e.dumpChanges=function(e){for(var t=[e.$changes],n={},o=n,r=function(e){var n=t[e];n.changes.forEach((function(e){var t=n.ref,r=e.index,i=t._definition?t._definition.fieldsByIndex[r]:t.$indexes.get(r);o[i]=n.getValue(r)}))},i=0;i<1;i++)r(i);return n},e.encode=L,e.filter=function(e){return function(t,n){var o=t.constructor;o._definition.addFilter(n,e)&&(o._context.useFilters=!0)}},e.filterChildren=function(e){return function(t,n){var o=t.constructor;o._definition.addChildrenFilter(n,e)&&(o._context.useFilters=!0)}},e.hasFilter=function(e){return e._context&&e._context.useFilters},e.registerType=y,e.type=_,Object.defineProperty(e,"__esModule",{value:!0})}(t)},j(V={exports:{}},V.exports),V.exports),B=function(){function t(e,t){var n=this;this.onStateChange=L(),this.onError=L(),this.onLeave=L(),this.onJoin=L(),this.hasJoined=!1,this.onMessageHandlers=N(),this.roomId=null,this.name=e,t&&(this.serializer=new(D("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError((function(e,t){return console.warn("colyseus.js - onError => (".concat(e,") ").concat(t))})),this.onLeave((function(){return n.removeAllListeners()}))}return Object.defineProperty(t.prototype,"id",{get:function(){return this.roomId},enumerable:!1,configurable:!0}),t.prototype.connect=function(e,n,o){void 0===o&&(o=this);var r=new x;o.connection=r,r.events.onmessage=t.prototype.onMessageCallback.bind(o),r.events.onclose=function(e){if(!o.hasJoined)return console.warn("Room connection was closed unexpectedly (".concat(e.code,"): ").concat(e.reason)),void o.onError.invoke(e.code,e.reason);e.code===c.DEVMODE_RESTART&&n?n():(o.onLeave.invoke(e.code),o.destroy())},r.events.onerror=function(e){console.warn("Room, onError (".concat(e.code,"): ").concat(e.reason)),o.onError.invoke(e.code,e.reason)},r.connect(e)},t.prototype.leave=function(t){var n=this;return void 0===t&&(t=!0),new Promise((function(o){n.onLeave((function(e){return o(e)})),n.connection?t?n.connection.send([e.Protocol.LEAVE_ROOM]):n.connection.close():n.onLeave.invoke(c.CONSENTED)}))},t.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)},t.prototype.send=function(t,n){var o,r=[e.Protocol.ROOM_DATA];if("string"==typeof t?F.encode.string(r,t):F.encode.number(r,t),void 0!==n){var i=A(n);(o=new Uint8Array(r.length+i.byteLength)).set(new Uint8Array(r),0),o.set(new Uint8Array(i),r.length)}else o=new Uint8Array(r);this.connection.send(o.buffer)},t.prototype.sendBytes=function(t,n){var o,r=[e.Protocol.ROOM_DATA_BYTES];"string"==typeof t?F.encode.string(r,t):F.encode.number(r,t),(o=new Uint8Array(r.length+(n.byteLength||n.length))).set(new Uint8Array(r),0),o.set(new Uint8Array(n),r.length),this.connection.send(o.buffer)},Object.defineProperty(t.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),t.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},t.prototype.onMessageCallback=function(t){var n=Array.from(new Uint8Array(t.data)),o=n[0];if(o===e.Protocol.JOIN_ROOM){var r=1,i=P(n,r);if(r+=S(i),this.serializerId=P(n,r),r+=S(this.serializerId),!this.serializer){var s=D(this.serializerId);this.serializer=new s}n.length>r&&this.serializer.handshake&&this.serializer.handshake(n,{offset:r}),this.reconnectionToken="".concat(this.roomId,":").concat(i),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(o===e.Protocol.ERROR){var a={offset:1},c=F.decode.number(n,a),u=F.decode.string(n,a);this.onError.invoke(c,u)}else if(o===e.Protocol.LEAVE_ROOM)this.leave();else if(o===e.Protocol.ROOM_DATA_SCHEMA){var h={offset:1};(u=new(d=this.serializer.getState().constructor._context.get(F.decode.number(n,h)))).decode(n,h),this.dispatchMessage(d,u)}else if(o===e.Protocol.ROOM_STATE)n.shift(),this.setState(n);else if(o===e.Protocol.ROOM_STATE_PATCH)n.shift(),this.patch(n);else if(o===e.Protocol.ROOM_DATA){var f={offset:1},d=F.decode.stringCheck(n,f)?F.decode.string(n,f):F.decode.number(n,f);u=n.length>f.offset?function(e,t){void 0===t&&(t=0);var n=new b(e,t),o=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return o}(t.data,f.offset):void 0,this.dispatchMessage(d,u)}else if(o===e.Protocol.ROOM_DATA_BYTES){var l={offset:1};d=F.decode.stringCheck(n,l)?F.decode.string(n,l):F.decode.number(n,l),this.dispatchMessage(d,new Uint8Array(n.slice(l.offset)))}},t.prototype.setState=function(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())},t.prototype.patch=function(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())},t.prototype.dispatchMessage=function(e,t){var n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):console.warn("colyseus.js: onMessage() not registered for type '".concat(e,"'."))},t.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},t.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$".concat(e._typeid);case"string":return e;case"number":return"i".concat(e);default:throw new Error("invalid message type.")}},t}(),J=function(e){function t(n,o){var r=e.call(this,n)||this;return r.code=o,Object.setPrototypeOf(r,t.prototype),r}return o(t,e),t}(Error),q="undefined"!=typeof window&&void 0!==(null===(U=null===window||void 0===window?void 0:window.location)||void 0===U?void 0:U.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567",Z=function(){function e(e){if(void 0===e&&(e=q),"string"==typeof e){var t=new URL(e),n="https:"===t.protocol||"wss:"===t.protocol,o=Number(t.port||(n?443:80));this.settings={hostname:t.hostname,pathname:"/"!==t.pathname?t.pathname:"",port:o,secure:n}}else void 0===e.port&&(e.port=e.secure?443:80),void 0===e.pathname&&(e.pathname=""),this.settings=e}return e.prototype.joinOrCreate=function(e,t,n){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,o.sent()]}}))}))},e.prototype.create=function(e,t,n){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,o.sent()]}}))}))},e.prototype.join=function(e,t,n){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,o.sent()]}}))}))},e.prototype.joinById=function(e,t,n){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,o.sent()]}}))}))},e.prototype.reconnect=function(e,t){return r(this,void 0,void 0,(function(){var n,o,r;return i(this,(function(i){switch(i.label){case 0:if("string"==typeof e&&"string"==typeof t)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");return n=e.split(":"),o=n[0],r=n[1],[4,this.createMatchMakeRequest("reconnect",o,{reconnectionToken:r},t)];case 1:return[2,i.sent()]}}))}))},e.prototype.getAvailableRooms=function(e){return void 0===e&&(e=""),r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,p(this.getHttpEndpoint("".concat(e)),{headers:{Accept:"application/json"}})];case 1:return[2,t.sent().data]}}))}))},e.prototype.consumeSeatReservation=function(e,t,n){return r(this,void 0,void 0,(function(){var o,s,a,c=this;return i(this,(function(u){return(o=this.createRoom(e.room.name,t)).roomId=e.room.roomId,o.sessionId=e.sessionId,s={sessionId:o.sessionId},e.reconnectionToken&&(s.reconnectionToken=e.reconnectionToken),a=n||o,o.connect(this.buildEndpoint(e.room,s),e.devMode&&function(){return r(c,void 0,void 0,(function(){var n,s,c=this;return i(this,(function(u){return console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(o.roomId,"'...")),n=0,s=function(){return r(c,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:n++,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.consumeSeatReservation(e,t,a)];case 2:return r.sent(),console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(o.roomId,"'")),[3,4];case 3:return r.sent(),n<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(n," out of ").concat(8,")")),setTimeout(s,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs.")),[3,4];case 4:return[2]}}))}))},setTimeout(s,2e3),[2]}))}))},a),[2,new Promise((function(e,t){var n=function(e,n){return t(new m(e,n))};a.onError.once(n),a.onJoin.once((function(){a.onError.remove(n),e(a)}))}))]}))}))},e.prototype.createMatchMakeRequest=function(e,t,n,o,s){return void 0===n&&(n={}),r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return[4,y(this.getHttpEndpoint("".concat(e,"/").concat(t)),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((r=i.sent().data).error)throw new J(r.error,r.code);return"reconnect"===e&&(r.reconnectionToken=n.reconnectionToken),[4,this.consumeSeatReservation(r,o,s)];case 2:return[2,i.sent()]}}))}))},e.prototype.createRoom=function(e,t){return new B(e,t)},e.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var o in t)t.hasOwnProperty(o)&&n.push("".concat(o,"=").concat(t[o]));var r=this.settings.secure?"wss://":"ws://";return e.publicAddress?r+="".concat(e.publicAddress):r+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname),"".concat(r,"/").concat(e.processId,"/").concat(e.roomId,"?").concat(n.join("&"))},e.prototype.getHttpEndpoint=function(e){return void 0===e&&(e=""),"".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname,"/matchmake/").concat(e)},e.prototype.getEndpointPort=function(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""},e}();function z(){return H||(H="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),H}var K,G="colyseus-auth-token";e.Platform=void 0,(K=e.Platform||(e.Platform={})).ios="ios",K.android="android";var Y=function(){function e(e){var t,n,o,r=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=e.replace("ws","http"),t=G,n=function(e){return r.token=e},o=z().getItem(t),"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return n(e)})):n(o)}return Object.defineProperty(e.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),e.prototype.login=function(e){return void 0===e&&(e={}),r(this,void 0,void 0,(function(){var t,n,o;return i(this,(function(r){switch(r.label){case 0:return t=Object.assign({},e),this.hasToken&&(t.token=this.token),[4,this.request("post","/auth",t)];case 1:for(o in n=r.sent(),this.token=n.token,i=G,s=this.token,z().setItem(i,s),n)this.hasOwnProperty(o)&&(this[o]=n[o]);return this.registerPingService(),[2,this]}var i,s}))}))},e.prototype.save=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return e.sent(),[2,this]}}))}))},e.prototype.getFriends=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}}))}))},e.prototype.getOnlineFriends=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}}))}))},e.prototype.getFriendRequests=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}}))}))},e.prototype.sendFriendRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.acceptFriendRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.declineFriendRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.blockUser=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.unblockUser=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.request=function(e,t,n,o,s){return void 0===n&&(n={}),void 0===s&&(s={}),r(this,void 0,void 0,(function(){var r,a,c,u;return i(this,(function(i){switch(i.label){case 0:for(a in s.Accept="application/json",this.hasToken&&(s.Authorization="Bearer "+this.token),r=[],n)r.push("".concat(a,"=").concat(n[a]));return c=r.length>0?"?".concat(r.join("&")):"",u={headers:s},o&&(u.body=o),[4,v[e]("".concat(this.endpoint).concat(t).concat(c),u)];case 1:return[2,i.sent().data]}}))}))},e.prototype.logout=function(){var e;this.token=void 0,e=G,z().removeItem(e),this.unregisterPingService()},e.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval((function(){return t.request("get","/auth")}),e)},e.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},e}(),W=function(){function e(){}return e.prototype.setState=function(e){return this.state.decode(e)},e.prototype.getState=function(){return this.state},e.prototype.patch=function(e){return this.state.decode(e)},e.prototype.teardown=function(){var e,t;null===(t=null===(e=this.state)||void 0===e?void 0:e.$changes)||void 0===t||t.root.clearRefs()},e.prototype.handshake=function(e,t){this.state?(new F.Reflection).decode(e,t):this.state=F.Reflection.decode(e,t)},e}(),X=function(){function e(){}return e.prototype.setState=function(e){},e.prototype.getState=function(){return null},e.prototype.patch=function(e){},e.prototype.teardown=function(){},e.prototype.handshake=function(e){},e}();C("schema",W),C("none",X),e.Auth=Y,e.Client=Z,e.Room=B,e.SchemaSerializer=W,e.registerSerializer=C,Object.defineProperty(e,"__esModule",{value:!0})},n(t)},382:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRHelpers=void 0;const i=r(n(880));class s{constructor(e=!1){this.baseURL="/api/",this.sandboxMode=!1,s.instance||(this.sandboxMode=e&&!0===e,s.instance=this)}static deleteCookie(e){""!==s.getCookie(e)&&(document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;")}static game(){return s.isSandboxMode()?i.default.get("game.slug"):window.frameElement?window.frameElement.getAttribute("data-game-slug"):"sandbox-game"}static getCookie(e,t=!1){let n=e+"=",o=t?window.top.document.cookie:document.cookie,r=decodeURIComponent(o).split(";");for(let e=0;e<r.length;e++){let t=r[e];for(;" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(n))return t.substring(n.length,t.length)}return""}static getData(e){return fetch(`${s.instance.baseURL}${e}`,Object.assign(Object.assign({},s.instance.requestConfig()),{method:"GET"})).then((e=>o(this,void 0,void 0,(function*(){const t=yield e.json();return"status"in t?t.status.success?t:Promise.reject(t):Promise.reject({status:{success:!1,code:e.status,debug:"err_malformed",message:"The response data from server did not contain a valid structure. Please try again later."},errors:["The response data from server did not contain a valid structure. Please try again later."],data:null})})))).catch(this.parseRejection)}static isSandboxMode(){return s.instance.sandboxMode}static parseRejection(e){return o(this,void 0,void 0,(function*(){const t=yield e;return"status"in t?Promise.reject(t):Promise.reject({status:{success:!1,code:e.status,debug:"err_network",message:"A network error has occurred while processing your request. Please try again later."},errors:["A network error has occurred while processing your request. Please try again later."],data:null})}))}static postData(e,t={}){return fetch(`${s.instance.baseURL}${e}`,Object.assign(Object.assign({},s.instance.requestConfig()),{method:"POST",body:JSON.stringify(t)})).then((e=>o(this,void 0,void 0,(function*(){const t=yield e.json();return"status"in t?t.status.success?t:Promise.reject(t):Promise.reject({status:{success:!1,code:e.status,debug:"err_malformed",message:"The response data from server did not contain a valid structure. Please try again later."},errors:["The response data from server did not contain a valid structure. Please try again later."],data:null})})))).catch(this.parseRejection)}requestConfig(){return{mode:"cors",cache:"no-cache",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s.getCookie("p1_auth_cookie"),"X-XSRF-TOKEN":s.getCookie("XSRF-TOKEN")},redirect:"follow",referrerPolicy:"no-referrer"}}static setCookie(e,t,n,o=!1){let r="";if(n){let e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),r="; expires="+e.toUTCString()}o?window.top.document.cookie=e+"="+(t||"")+r+"; path=/":document.cookie=e+"="+(t||"")+r+"; path=/"}}t.HeyVRHelpers=s},805:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRArena=void 0;const r=n(354),i=n(382),s=o(n(880)),a=n(898);class c{constructor(){this.colyseus=null,this.initial={roomId:null,lobbyId:null,name:null,team:"default",password:"",reconnectionToken:"",token:this.arenaToken()},this.config=Object.assign({},this.initial),this.lobby=void 0,c.booted||this.connection().then((e=>this.colyseus=e))}abandon(){return new Promise(((e,t)=>{if(!this.lobby)return t("You haven't connected to any lobbies yet.");this.lobby.leave().then((()=>this.lobby=void 0)).then((()=>this.config=Object.assign({},this.initial))).then((()=>e(!0))).catch((()=>e(!1)))}))}arenaToken(){return i.HeyVRHelpers.isSandboxMode()?s.default.get("arena.token"):i.HeyVRHelpers.getCookie("p1_arena_cookie")}connection(){return new Promise((e=>{this.colyseus||(this.colyseus=new a.Client(`wss://${window.location.host}:9999`)),e(this.colyseus)}))}createLobby(e){return new Promise(((t,n)=>e.roomSlug?(this.config.roomId=e.roomSlug,e.name&&(this.config.name=String(e.name)),e.team&&""!==e.team.toString()&&(this.config.team=String(e.team)),this.config.password=e.password?String(e.password):"",this.connection().then((()=>r.HeyVRLobby.from(this.colyseus,Object.assign(Object.assign({},this.config),{token:this.arenaToken()})).then((e=>{this.lobby=e,this.config.reconnectionToken=e.reconnectionToken(),t(e)}))))):n("Please specify a room name to list the lobbies.")))}getLobby(){return new Promise(((e,t)=>{if(this.lobby)return e(this.lobby);t("You aren't connected to any lobby.")}))}joinLobby(e){return new Promise(((t,n)=>e.roomSlug?(this.config.roomId=e.roomSlug,e.lobbyId?(this.config.lobbyId=e.lobbyId,e.team&&""!==e.team.toString()&&(this.config.team=String(e.team)),this.config.password=e.password?String(e.password):"",void this.connection().then((()=>r.HeyVRLobby.from(this.colyseus,Object.assign(Object.assign({},this.config),{token:this.arenaToken()})).then((e=>{this.lobby=e,this.config.reconnectionToken=e.reconnectionToken(),t(e)}))))):n("Please specify a lobby ID to join.")):n("Please specify a room name to join.")))}lobbies(e){return new Promise(((t,n)=>{if(!e)return n("Please specify a room name to list the lobbies.");this.config.roomId=e,this.connection().then((e=>e.getAvailableRooms())).then((e=>t(e.map((e=>({lobbyId:e.roomId,name:e.metadata.name,players:e.metadata.players,private:e.metadata.private,maxPlayers:e.maxClients}))))))}))}reconnect(){return new Promise(((e,t)=>{if(!this.lobby)return t("You haven't connected to any lobbies yet.");this.lobby.reconnect(this.colyseus,this.config).then((t=>{this.lobby=t,e(t)}))}))}}t.HeyVRArena=c,c.booted=!1},880:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static get(e){if(!this.keys.includes(e))return null;"heyVRConfig"in window&&0!==Object.keys(window.heyVRConfig).length||(window.heyVRConfig={arena:{token:""},game:{slug:"sandbox-game"}});let t={};const n=e.split(".");for(let e=0;e<n.length;e++)if(0!==e){if(!(n[e]in t))return null;t=t[n[e]]}else t=window.heyVRConfig[n[e]];return t}static set(e,t){if(!this.keys.includes(e))return!1;const n=e.split("."),o=n.length;return n.reduce(((e,n,r)=>void 0===e[n]&&r!==o-1?(e[n]={},e[n]):r===o-1?(e[n]=t,t):e[n]),window.heyVRConfig),!0}}n.keys=["game.slug","arena.token"],t.default=n},720:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRImmersiveVR=void 0;const o=n(44);t.HeyVRImmersiveVR=class{constructor(){this.session=new o.HeyVRImmersiveVRSession}get events(){return this.session.vrEvents()}currentSession(){return this.session.getSession()}enterVR(){return this.session.createSession()}exitVR(){return this.session.endSession()}}},44:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRImmersiveVRSession=void 0,t.HeyVRImmersiveVRSession=class{constructor(){this.registeredEvents={},this.session=null;const e=this;"xr"in window.navigator&&window.navigator.xr&&(window.navigator.xr.isSessionSupported("immersive-vr").then((t=>{var n;t&&(window.navigator.xr.requestSession=(n=window.navigator.xr.requestSession,function(){return n.apply(this,arguments).then((t=>(e.setSession(t),"start"in e.registeredEvents&&e.registeredEvents.start.forEach((e=>e())),t)))}))})),this.XR=window.navigator.xr)}createSession(){return new Promise(((e,t)=>this.session?e(this.session):void 0===this.XR?t(!1):void this.XR.requestSession("immersive-vr").then((t=>e(t))).catch((()=>t(!1)))))}endSession(){return new Promise((e=>{if(!this.session)return e(!1);this.session.end().then((()=>{this.session=null,e(!0)}))}))}getSession(){return this.session}setSession(e){this.session=e}vrEvents(){const e=this;return{onStart:t=>{"function"==typeof t?"start"in e.registeredEvents?e.registeredEvents.start.push(t):e.registeredEvents.start=[t]:console.error("heyVR: Only callable objects can be registered as VR event callbacks.")},onEnd:t=>{var n;"function"==typeof t?null===(n=e.session)||void 0===n||n.addEventListener("end",t):console.error("heyVR: Only callable objects can be registered as VR event callbacks.")},onVisible:t=>{var n;"function"==typeof t?null===(n=e.session)||void 0===n||n.addEventListener("visibilitychange",(e=>{"visible"===e.session.visibilityState&&t()})):console.error("heyVR: Only callable objects can be registered as VR event callbacks.")},onHide:t=>{var n;"function"==typeof t?null===(n=e.session)||void 0===n||n.addEventListener("visibilitychange",(e=>{"hidden"===e.session.visibilityState&&t()})):console.error("heyVR: Only callable objects can be registered as VR event callbacks.")},onBlur:t=>{var n;"function"==typeof t?null===(n=e.session)||void 0===n||n.addEventListener("visibilitychange",(e=>{"visible-blurred"===e.session.visibilityState&&t()})):console.error("heyVR: Only callable objects can be registered as VR event callbacks.")}}}}},354:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRLobby=void 0;const r=n(382);class i{constructor(){if(this.eventHandlers={},this.sandboxMode=!1,i.instance)throw new Error("Can not have more than one lobby instance.");i.events.forEach((e=>{this.getLobby().onMessage(e,(t=>this.dispatch(e,t)))}))}get actions(){return{listPlayers:()=>new Promise((e=>{this.on("command.listPlayers.result",(t=>e(t))),this.getLobby().send("command.listPlayers")})),destroyLobby:()=>{this.getLobby().send("command.destroy"),this.destroy()}}}get commands(){return{kickPlayer:e=>new Promise(((t,n)=>{this.on("command.kick.result",(e=>e.success?t(e.message):n(e.message))),this.getLobby().send("command.kick",e)})),banPlayer:e=>new Promise(((t,n)=>{this.on("command.ban.result",(e=>e.success?t(e.message):n(e.message))),this.getLobby().send("command.ban",e)})),unbanPlayer:e=>new Promise(((t,n)=>{this.on("command.unban.result",(e=>e.success?t(e.message):n(e.message))),this.getLobby().send("command.unban",e)}))}}get communications(){return{allChat:e=>new Promise((t=>{this.on("communication.allChat.result",(e=>t(e))),this.getLobby().send("communication.allChat",{message:e})})),teamChat:(e,t)=>new Promise((n=>{this.on("communication.teamChat.result",(e=>n(e))),this.getLobby().send("communication.teamChat",{message:e,team:t?String(t):""})})),whisper:(e,t)=>new Promise((n=>{this.on("communication.whisper.result",(e=>n(e))),this.getLobby().send("communication.whisper",{message:e,username:t,whisper:!0})})),mute:e=>new Promise((t=>{this.on("communication.mute.result",(e=>t(e))),this.getLobby().send("communication.mute",e)})),unmute:e=>new Promise((t=>{this.on("communication.unmute.result",(e=>t(e))),this.getLobby().send("communication.unmute",e)})),call:()=>{throw new Error("Voice call is not implemented yet.")},hangUp:()=>{throw new Error("Voice call is not implemented yet.")},onMessage:e=>{this.getLobby().onMessage("communication.message",e)}}}get data(){return{sendToAll:e=>{e&&this.getLobby().send("rawDataAll",{payload:e})},sendToTeam:(e,t)=>{e&&this.getLobby().send("rawDataTeam",{payload:e,team:t?String(t):""})},onReceiveAll:e=>{this.getLobby().onMessage("rawDataAll",e)},onReceiveTeam:e=>{this.getLobby().onMessage("rawDataTeam",e)}}}get events(){return{onDisconnect:e=>{this.getLobby().onLeave(e)},onError:e=>{this.getLobby().onError(e)},onMessage:e=>{this.on("system.message",e)},onPlayerSync:e=>{this.on("system.players.sync",e)}}}get session(){return{userId:this.getLobby().sessionId,lobbyId:this.getLobby().id}}get state(){return{get current(){throw new Error("Server state management has not been implemented yet.")},onChange:e=>{this.getLobby().onStateChange(e)}}}destroy(){i.lobby=i.instance=void 0}dispatch(e,t){e in this.eventHandlers&&this.eventHandlers[e](t)}static from(e,t){return o(this,void 0,void 0,(function*(){return i.instance||(t.lobbyId?yield e.joinById(t.lobbyId,{accessToken:t.token,password:t.password,team:t.team}).then((e=>i.lobby=e)).then((()=>i.instance=new i)):yield e.create(`${r.HeyVRHelpers.game()}_${t.roomId}`,{accessToken:t.token,password:t.password,team:t.team,name:t.name}).then((e=>i.lobby=e)).then((()=>i.instance=new i))),i.instance}))}getLobby(){if(!i.lobby)throw new Error("Can not access the lobby before initialization.");return i.lobby}leave(){return this.getLobby().leave(!0).then((()=>this.destroy()))}on(e,t){this.eventHandlers[e]=t}reconnect(e,t){return e.reconnect(t.reconnectionToken).then((e=>i.lobby=e)).then((()=>new i))}reconnectionToken(){return i.lobby?i.lobby.reconnectionToken:""}}t.HeyVRLobby=i,i.events=["command.kick.result","command.ban.result","command.unban.result","command.listPlayers.result","communication.mute.result","communication.unmute.result","communication.allChat.result","communication.teamChat.result","communication.whisper.result","system.message","system.players.sync"],i.instance=void 0,i.lobby=void 0},307:function(e,t,n){"use strict";var o,r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(665),s=n(627),a=n(516),c=n(277),u=n(475),h=n(848),f=n(382),d=n(720),l=r(n(880));if("undefined"==typeof window||"undefined"!=typeof process&&"node"===(null===(o=process.release)||void 0===o?void 0:o.name))console.error("heyVR SDK was loaded via Node. The SDK can only function in the browser environment.");else{new f.HeyVRHelpers(!0);const e=new s.HeyVRInventorySandbox(h.heyVRSDKSandboxData.inventory,h.heyVRSDKSandboxData.user),t=new a.HeyVRLeaderboardSandbox(h.heyVRSDKSandboxData.leaderboard,h.heyVRSDKSandboxData.user),n=new c.HeyVRArenaSandbox,o=new i.HeyVRGameSaveSandbox(h.heyVRSDKSandboxData.saveGame),r=new u.HeyVRUserSandbox(h.heyVRSDKSandboxData.user),p=new d.HeyVRImmersiveVR,y={importConfig:n=>{if("config"in n)for(const e in n.config)l.default.set(e,n.config[e]);"inventory"in n&&e.mock(n.inventory),"leaderboard"in n&&t.mock(n.leaderboard),"saveGame"in n&&o.mock(n.saveGame),"user"in n&&(r.mock(n.user),e.mock("inventory"in n?n.inventory:h.heyVRSDKSandboxData.inventory,n.user))},importConfigURL:e=>{fetch(e,{mode:"no-cors"}).then((e=>e.text())).then((e=>y.importConfig(JSON.parse(e)))).catch((e=>console.error(`Could not import the config from the given URL, error message: ${e}`)))},inventory:(t,n)=>e.mock(t,n),leaderboard:e=>t.mock(e),saveGame:e=>o.mock(e),user:e=>r.mock(e)};window.heyVR={inventory:e,leaderboard:t,arena:n,saveGame:o,user:r,mock:y,vr:p,config:{get:e=>l.default.get(e),set:(e,t)=>l.default.set(e,t)}}}},848:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.heyVRSDKSandboxData=void 0,t.heyVRSDKSandboxData={inventory:{catalog:[{name:"Super cool item",slug:"cool-item",price:100,model:"",thumbnail:"https://heyvr.io/assets/img/placeholder/placeholder_full.jpg",item_class:"unlockable",type:"singular",expires_after:0},{name:"Even cooler item",slug:"cooler-item",price:500,model:"",thumbnail:"https://heyvr.io/assets/img/placeholder/placeholder_full.jpg",item_class:"unlockable",type:"singular",expires_after:0},{name:"Coolest item",slug:"coolest-item",price:1e3,model:"",thumbnail:"https://heyvr.io/assets/img/placeholder/placeholder_full.jpg",item_class:"unlockable",type:"singular",expires_after:0}],myItems:[{name:"My Item 1",slug:"my-item-1",type:"singular",owned_count:1,expires_on:"",purchased_on:(new Date).toISOString()},{name:"My Item 2",slug:"my-item-2",type:"stackable",owned_count:12,expires_on:(new Date).toISOString(),purchased_on:(new Date).toISOString()}]},leaderboard:{scores:[{rank:1,score:6304,user:"Player1",created_at:"2023-02-13T17:19:11.000000Z"},{rank:2,score:6305,user:"Player2",created_at:"2023-03-10T19:51:32.000000Z"},{rank:3,score:6306,user:"Player3",created_at:"2023-03-10T19:49:46.000000Z"},{rank:4,score:6321,user:"Player4",created_at:"2023-03-10T19:52:38.000000Z"},{rank:5,score:6330,user:"Player5",created_at:"2023-03-05T18:13:27.000000Z"},{rank:6,score:6334,user:"Player6",created_at:"2023-03-05T18:14:01.000000Z"},{rank:7,score:6339,user:"Player7",created_at:"2023-01-19T18:26:31.000000Z"},{rank:8,score:9343,user:"Player8",created_at:"2023-03-10T19:53:21.000000Z"},{rank:9,score:9351,user:"Player9",created_at:"2023-03-10T19:54:09.000000Z"},{rank:10,score:12361,user:"Player10",created_at:"2023-03-10T19:50:52.000000Z"}],mine:[{score:6304,user:"Player1",created_at:"2023-02-13T17:19:11.000000Z",rank:10},{score:6305,user:"Player2",created_at:"2023-03-10T19:51:32.000000Z",rank:11},{score:6306,user:"Player3",created_at:"2023-03-10T19:49:46.000000Z",rank:13},{score:6321,user:"Player4",created_at:"2023-03-10T19:52:38.000000Z",rank:25},{score:6330,user:"Player5",created_at:"2023-03-05T18:13:27.000000Z",rank:66},{score:6334,user:"Player6",created_at:"2023-03-05T18:14:01.000000Z",rank:818},{score:6339,user:"Player7",created_at:"2023-01-19T18:26:31.000000Z",rank:91},{score:9343,user:"Player8",created_at:"2023-03-10T19:53:21.000000Z",rank:2},{score:9351,user:"Player9",created_at:"2023-03-10T19:54:09.000000Z",rank:35},{score:12361,user:"Player10",created_at:"2023-03-10T19:50:52.000000Z",rank:15}],friends:[{rank:12,score:6304,user:"Friend 1",created_at:"2023-02-13T17:19:11.000000Z"},{rank:15,score:6305,user:"Friend 2",created_at:"2023-03-10T19:51:32.000000Z"},{rank:83,score:6306,user:"Friend 3",created_at:"2023-03-10T19:49:46.000000Z"},{rank:92,score:6321,user:"Friend 4",created_at:"2023-03-10T19:52:38.000000Z"},{rank:103,score:6330,user:"Friend 5",created_at:"2023-03-05T18:13:27.000000Z"},{rank:122,score:6334,user:"Friend 6",created_at:"2023-03-05T18:14:01.000000Z"},{rank:125,score:6339,user:"Friend 7",created_at:"2023-01-19T18:26:31.000000Z"},{rank:991,score:9343,user:"Friend 8",created_at:"2023-03-10T19:53:21.000000Z"},{rank:10901,score:9351,user:"Friend 9",created_at:"2023-03-10T19:54:09.000000Z"},{rank:192871,score:12361,user:"Friend 10",created_at:"2023-03-10T19:50:52.000000Z"}]},saveGame:{slots:{1:{name:"Save Slot 1",save_data:JSON.stringify({key_1:"Value 1",key_2:"Value 2"}),created_at:"2023-03-10T19:54:09.000000Z",updated_at:"2023-03-10T19:59:52.000000Z"},2:{name:"Save Slot 2",save_data:JSON.stringify({key_3:"Value 3",key_4:"Value 4"}),created_at:"2023-03-05T18:14:01.000000Z",updated_at:"2023-03-07T19:15:01.000000Z"},3:{name:"Save Slot 3",save_data:JSON.stringify({key_5:"Value 5",key_6:"Value 6"}),created_at:"2023-03-10T19:49:46.000000Z",updated_at:"2023-04-10T11:40:41.000000Z"},4:{name:"Save Slot 4",save_data:JSON.stringify({key_7:"Value 7",key_8:"Value 8"}),created_at:"2023-02-13T17:19:11.000000Z",updated_at:"2023-02-13T17:19:11.000000Z"},5:{name:"Save Slot 5",save_data:JSON.stringify({key_9:"Value 9",key_10:"Value 10"}),created_at:"2023-03-05T18:13:27.000000Z",updated_at:"2023-03-12T10:11:02.000000Z"}}},user:{loggedIn:!0,responseDelay:1e3,username:"heyVRUser",userBalance:1250},config:{"arena.token":"YOUR API TOKEN","game.slug":"sandbox-game"}}},277:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRArenaSandbox=void 0;const o=n(805),r=n(898);class i extends o.HeyVRArena{connection(){return new Promise((e=>{if(this.colyseus)e(this.colyseus);else{const t=["heyvr.test","heyvr.dev","heyvr.io"].includes(window.location.host)?window.location.host:"heyvr.io";this.colyseus=new r.Client(`wss://${t}:9999`),e(this.colyseus)}}))}}t.HeyVRArenaSandbox=i},665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRGameSaveSandbox=void 0,t.HeyVRGameSaveSandbox=class{constructor(e){this.config=e}all(){return new Promise((e=>e(this.config.slots)))}load(e){return new Promise(((t,n)=>{const o=Number.isInteger(e)?Number(e):1;if(o in this.config.slots)return t(Object.assign(Object.assign({},this.config.slots[o]),{save_data:JSON.parse(this.config.slots[o].save_data)}));n({status:{success:!1,code:422,debug:"err_invalid_slot",message:"The save slot does not exist."},data:null})}))}mock(e){this.config=e}remove(e){return new Promise(((t,n)=>{const o=Number.isInteger(e)?Number(e):1;if(!(o in this.config.slots))return n({status:{success:!1,code:404,debug:"err_invalid_save",message:"The specified save slot does not exist for this game."},data:null});delete this.config.slots[o],t(!0)}))}wipe(){return new Promise((e=>e(!0)))}write(e,t,n,o){if(!e)throw new Error("Please provide a valid JSON data for your save!");return new Promise(((r,i)=>{const s=Number.isInteger(n)?Number(n):1;return s>=5?i({status:{success:!1,code:507,debug:"err_max_save_slots",message:"You have reached the maximum 5 save slot for this game. Please delete some first, or enable save overwrite."},data:null}):s in this.config.slots&&!0!==t?i({status:{success:!1,code:412,debug:"err_save_exists",message:"The save slot already exists, but overwrite is not enabled."},data:null}):(this.config.slots[s]={name:String(o),save_data:JSON.stringify(e),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},void r(!0))}))}}},627:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRInventorySandbox=void 0,t.HeyVRInventorySandbox=class{constructor(e,t){this.config=e,this.userConfig=t}get(){return new Promise((e=>e(this.config.myItems)))}getCatalog(){return new Promise((e=>e(this.config.catalog)))}mock(e,t){this.config=e,t&&(this.userConfig=t)}purchase(e,t){return new Promise(((n,o)=>{if(!this.userConfig.loggedIn)return o({status:{success:!1,code:412,debug:"err_not_logged_in",message:"You need to be logged in to make this request."},data:null});let r=this.config.catalog.find((t=>t.slug===e));if(!r)return o({status:{success:!1,code:404,debug:"err_not_found",message:"The requested item does not exist."},data:null});if("singular"===r.type&&(t>1||-1!==this.config.myItems.findIndex((e=>e.slug===r.slug))))return o({status:{success:!1,code:422,debug:"err_purchase_limit",message:"You can only buy/own a single instance of this item."},data:null});if(r.price*t>this.userConfig.userBalance)return o({status:{success:!1,code:422,debug:"err_not_enough_coins",message:"You don't own enough coins to buy this item."},data:null});let i=new Date;this.config.myItems.push({name:r.name,slug:r.slug,owned_count:1,type:r.type,purchased_on:(new Date).toISOString(),expires_on:i.setDate(i.getDate()+r.expires_after).toString()}),n(`You have successfully purchased the '${r.name}' item.`)}))}}},516:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRLeaderboardSandbox=void 0,t.HeyVRLeaderboardSandbox=class{constructor(e,t){this.config=e,this.userConfig=t}get(e,t){console.log(`Accessing highscores for the '${e}' leaderboard.`);let n=isNaN(t)?0:Number(t);n=0!==n?n:10;const o=[];for(let e=0;e<n;e++)void 0!==this.config.scores[e]?o.push(this.config.scores[e]):o.push(this.config.scores[this.config.scores.length]);return new Promise((e=>e(o)))}getFriends(e,t){console.log(`Accessing user's friends' highscores for the "${e}" Leaderboard.`);let n=isNaN(t)?0:Number(t);n=0!==n?n:10;const o=[];for(let e=0;e<n;e++)void 0!==this.config.friends[e]?o.push(this.config.friends[e]):o.push(this.config.friends[this.config.friends.length]);return new Promise((e=>e(o)))}getMy(e,t){console.log(`Accessing user's highscores for the '${e}' leaderboard.`);let n=isNaN(t)?0:Number(t);n=0!==n?n:10;const o=[];for(let e=0;e<n;e++)void 0!==this.config.mine[e]?o.push(this.config.mine[e]):o.push(this.config.mine[this.config.mine.length]);return new Promise((e=>e(o)))}mock(e){console.log("Sample data has been updated."),this.config=e}postScore(e,t){return console.log(`Posting score of '${t}' to the '${e}' leaderboard.`),new Promise(((e,n)=>this.userConfig.loggedIn?(this.config.scores.push({score:t,user:this.userConfig.username,created_at:(new Date).toISOString(),rank:this.config.scores.length+1}),e(!0)):n({status:{success:!1,code:412,debug:"err_unauthenticated",message:"You need to be logged in to be able to post your score."},data:null})))}stats(e){var t,n;return Promise.resolve({name:`Name: ${e}`,scores:this.config.scores.length,highest:(null===(t=this.config.scores.sort(((e,t)=>e.score>t.score?1:-1))[0])||void 0===t?void 0:t.score)||null,latest:(null===(n=this.config.scores.sort(((e,t)=>e.created_at>t.created_at?1:-1))[0])||void 0===n?void 0:n.created_at)||null,created_at:(new Date).toString(),updated_at:(new Date).toString()})}}},475:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeyVRUserSandbox=void 0;const o=n(416);t.HeyVRUserSandbox=class{constructor(e){this.config=e}getAmountCoins(){return new Promise(((e,t)=>{if(this.config.loggedIn)return e(this.config.userBalance);t(!1)}))}getName(){return new Promise(((e,t)=>{this.config.loggedIn?e(this.config.username):t("heyVR: check whether user is logged in before trying to get the name!")}))}isLoggedIn(){return new Promise((e=>e(this.config.loggedIn)))}mock(e){this.config=e}openLogin(){return new Promise((e=>{this.isLoggedIn().then((t=>{if(t)throw new o.SdkError("User is already logged in.","already_logged_in");const n=setTimeout((()=>{clearTimeout(n),e({action:"login",username:this.config.username})}),2e3)}))}))}}},416:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdkError=void 0;class n extends Error{constructor(e,t){super(),this.name="heyVrError",this.message=e,this.debug=t}getDebug(){return this.debug}getMessage(){return this.message}}t.SdkError=n}},t={};!function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(307)})();